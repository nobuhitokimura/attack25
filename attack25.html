<html>
<head>
<link rel="stylesheet" type="text/css" href="scr.css">
<title>t2sa-quize</title>

</head>

<body>
	
	<!-- -------------------------table------------------------- -->
	
	<div id="table" width="500" height="700"></div>
	<br>

	<!-- ---------------------ini checkbox--------------------- -->
	<form id="ini_cb" name="ini_cb" style="position:absolute; top:100px">
		<div style="position:absolute; left:100px; top:650px">checkbox</div>
 		<input type="checkbox" name="cb11" style="position:absolute; left:75px; top:675px" onchange="cb_change(0, 0)">
 		<input type="checkbox" name="cb12" style="position:absolute; left:100px; top:675px" onchange="cb_change(0, 1)">
 		<input type="checkbox" name="cb13" style="position:absolute; left:125px; top:675px" onchange="cb_change(0, 2)">
 		<input type="checkbox" name="cb14" style="position:absolute; left:150px; top:675px" onchange="cb_change(0, 3)">
 		<input type="checkbox" name="cb15" style="position:absolute; left:175px; top:675px" onchange="cb_change(0, 4)">
		<br>
 		<input type="checkbox" name="cb21" style="position:absolute; left:75px; top:700px" onchange="cb_change(1, 0)">
 		<input type="checkbox" name="cb22" style="position:absolute; left:100px; top:700px" onchange="cb_change(1, 1)">
 		<input type="checkbox" name="cb23" style="position:absolute; left:125px; top:700px" onchange="cb_change(1, 2)">
 		<input type="checkbox" name="cb24" style="position:absolute; left:150px; top:700px" onchange="cb_change(1, 3)">
 		<input type="checkbox" name="cb25" style="position:absolute; left:175px; top:700px" onchange="cb_change(1, 4)">
		<br>
 		<input type="checkbox" name="cb31" style="position:absolute; left:75px; top:725px" onchange="cb_change(2, 0)">
 		<input type="checkbox" name="cb32" style="position:absolute; left:100px; top:725px" onchange="cb_change(2, 1)">
 		<input type="checkbox" name="cb33" style="position:absolute; left:125px; top:725px" onchange="cb_change(2, 2)">
 		<input type="checkbox" name="cb34" style="position:absolute; left:150px; top:725px" onchange="cb_change(2, 3)">
 		<input type="checkbox" name="cb35" style="position:absolute; left:175px; top:725px" onchange="cb_change(2, 4)">
		<br>
 		<input type="checkbox" name="cb41" style="position:absolute; left:75px; top:750px" onchange="cb_change(3, 0)">
 		<input type="checkbox" name="cb42" style="position:absolute; left:100px; top:750px" onchange="cb_change(3, 1)">
 		<input type="checkbox" name="cb43" style="position:absolute; left:125px; top:750px" onchange="cb_change(3, 2)">
 		<input type="checkbox" name="cb44" style="position:absolute; left:150px; top:750px" onchange="cb_change(3, 3)">
 		<input type="checkbox" name="cb45" style="position:absolute; left:175px; top:750px" onchange="cb_change(3, 4)">
		<br>
 		<input type="checkbox" name="cb51" style="position:absolute; left:75px; top:775px" onchange="cb_change(4, 0)">
 		<input type="checkbox" name="cb52" style="position:absolute; left:100px; top:775px" onchange="cb_change(4, 1)">
 		<input type="checkbox" name="cb53" style="position:absolute; left:125px; top:775px" onchange="cb_change(4, 2)">
 		<input type="checkbox" name="cb54" style="position:absolute; left:150px; top:775px" onchange="cb_change(4, 3)">
 		<input type="checkbox" name="cb55" style="position:absolute; left:175px; top:775px" onchange="cb_change(4, 4)">
		<br>
	</form>

	<!-- radio box -->
	<form id="rdobox" name="rdobox" style="position:absolute; top:100px">
		<input name="hoge" type="radio" style="position:absolute; left:240px; top:650px" onclick="funcBlack()" checked> 
		<div style="position:absolute; left:270px; top:647px">black</div>
		<input name="hoge" type="radio" style="position:absolute; left:240px; top:675px" onclick="funcRed()">
		<div style="position:absolute; left:270px; top:672px">red</div>
		<input name="hoge" type="radio" style="position:absolute; left:240px; top:700px" onclick="funcBlue()">
		<div style="position:absolute; left:270px; top:697px">blue</div>
		<input name="hoge" type="radio" style="position:absolute; left:240px; top:725px" onclick="funcGreen()">
		<div style="position:absolute; left:270px; top:722px">green</div>
		<input name="hoge" type="radio" style="position:absolute; left:240px; top:750px" onclick="funcPink()">
		<div style="position:absolute; left:270px; top:747px">pink</div>
		<input name="hoge" type="radio" style="position:absolute; left:240px; top:775px" onclick="funcPurple()">
		<div style="position:absolute; left:270px; top:772px">purple</div>
	</form>

	<!-- ----------------------attack chance mode--------------------- -->
	<input type="checkbox" id="at" style="position:absolute; left:450px; top:850px" onchange="attackchance()">

	<!-- -------------------------reset button------------------------- -->
	<!--<div style="position:absolute; left:460px; top:845px">reset button</div>-->
	<input type="button" name="reset" value="reset" style="position:absolute; left:1850px; top:20px" onclick="check_reset()">

	<!-- -------------------------records------------------------- -->
	<div class="container_black" style="position:absolute; left:0px; top:-10px">
		<!--<div style="position:absolute; left:720px; top:50px; font-size:25px; color:black">black</div>-->
		<div class="range-slider_black" style="position:absolute; left:830px; top:-150px">
			<span id="rs-bullet_black" class="rs-label_black" style="position:absolute; left:0px; top:-100px">0</span>
    		<input id="rs-range-line_black" class="rs-range_black" type="range" value="0" min="0" max="25" disabled="disabled">
		</div>
	</div>

	<div class="container_red" style="position:absolute; left:400px; top:140px">
		<!--<div style="position:absolute; left:730px; top:50px; font-size:25px; color:red">red</div>-->
		<div class="range-slider_red" style="position:absolute; left:830px; top:-150px">
			<span id="rs-bullet_red" class="rs-label_red" style="position:absolute; left:0px; top:-100px">0</span>
    		<input id="rs-range-line_red" class="rs-range_red" type="range" value="0" min="0" max="25" disabled="disabled">
		</div>
	</div>

	<div class="container_blue" style="position:absolute; left:0px; top:290px">
		<!--<div style="position:absolute; left:730px; top:50px; font-size:25px; color:blue">blue</div>-->
		<div class="range-slider_blue" style="position:absolute; left:830px; top:-150px">
			<span id="rs-bullet_blue" class="rs-label_blue" style="position:absolute; left:0px; top:-100px">0</span>
    		<input id="rs-range-line_blue" class="rs-range_blue" type="range" value="0" min="0" max="25" disabled="disabled">
		</div>
	</div>	

	<div class="container_green" style="position:absolute; left:400px; top:440px">
		<!--<div style="position:absolute; left:730px; top:50px; font-size:25px; color:green">green</div>-->
		<div class="range-slider_green" style="position:absolute; left:830px; top:-150px">
			<span id="rs-bullet_green" class="rs-label_green" style="position:absolute; left:0px; top:-100px">0</span>
    		<input id="rs-range-line_green" class="rs-range_green" type="range" value="0" min="0" max="25" disabled="disabled">
		</div>
	</div>	

	<div class="container_pink" style="position:absolute; left:0px; top:590px">
		<!--<div style="position:absolute; left:730px; top:50px; font-size:25px; color:pink">pink</div>-->
		<div class="range-slider_pink" style="position:absolute; left:830px; top:-150px">
			<span id="rs-bullet_pink" class="rs-label_pink" style="position:absolute; left:0px; top:-100px">0</span>
    		<input id="rs-range-line_pink" class="rs-range_pink" type="range" value="0" min="0" max="25" disabled="disabled">
		</div>
	</div>	

	<div class="container_purple" style="position:absolute; left:400px; top:740px">
		<!--<div style="position:absolute; left:730px; top:50px; font-size:25px; color:purple">purple</div>-->
		<div class="range-slider_purple" style="position:absolute; left:830px; top:-150px">
			<span id="rs-bullet_purple" class="rs-label_purple" style="position:absolute; left:0px; top:-100px">0</span>
    		<input id="rs-range-line_purple" class="rs-range_purple" type="range" value="0" min="0" max="25" disabled="disabled">
		</div>
	</div>	

<script type="text/javascript">
	var color = 0;
	var cb_frag = Array(25);	//セルが使用されているか（もう選ばれた）
	var clr_frag = Array(25);	//各セルの背景の色情報（白は-1）
	var at_frag = 0;
	
	var rangeSlider_black = document.getElementById("rs-range-line_black");
	var rangeBullet_black = document.getElementById("rs-bullet_black");
	rangeSlider_black.addEventListener("input", showSliderValue_black, false);

	var rangeSlider_red = document.getElementById("rs-range-line_red");
	var rangeBullet_red = document.getElementById("rs-bullet_red");
	rangeSlider_red.addEventListener("input", showSliderValue_red, false);

	var rangeSlider_blue = document.getElementById("rs-range-line_blue");
	var rangeBullet_blue = document.getElementById("rs-bullet_blue");
	rangeSlider_blue.addEventListener("input", showSliderValue_blue, false);

	var rangeSlider_green = document.getElementById("rs-range-line_green");
	var rangeBullet_green = document.getElementById("rs-bullet_green");
	rangeSlider_green.addEventListener("input", showSliderValue_green, false);

	var rangeSlider_pink = document.getElementById("rs-range-line_pink");
	var rangeBullet_pink = document.getElementById("rs-bullet_pink");
	rangeSlider_pink.addEventListener("input", showSliderValue_pink, false);

	var rangeSlider_purple = document.getElementById("rs-range-line_purple");
	var rangeBullet_purple = document.getElementById("rs-bullet_purple");
	rangeSlider_purple.addEventListener("input", showSliderValue_purple, false);

	function showSliderValue_black() {
  		rangeBullet_black.innerHTML = rangeSlider_black.value;
  		//console.log(rangeSlider.value);
  		var bulletPosition_black = (rangeSlider_black.value / rangeSlider_black.max);
  		rangeBullet_black.style.left = (bulletPosition_black * 560 ) + "px";
	}

	function showSliderValue_red() {
  		rangeBullet_red.innerHTML = rangeSlider_red.value;
  		//console.log(rangeSlider.value);
  		var bulletPosition_red = (rangeSlider_red.value / rangeSlider_red.max);
  		rangeBullet_red.style.left = (bulletPosition_red * 560 ) + "px";
	}

	function showSliderValue_blue() {
  		rangeBullet_blue.innerHTML = rangeSlider_blue.value;
  		//console.log(rangeSlider.value);
  		var bulletPosition_blue = (rangeSlider_blue.value / rangeSlider_blue.max);
  		rangeBullet_blue.style.left = (bulletPosition_blue * 560 ) + "px";
	}

	function showSliderValue_green() {
  		rangeBullet_green.innerHTML = rangeSlider_green.value;
  		//console.log(rangeSlider.value);
  		var bulletPosition_green = (rangeSlider_green.value / rangeSlider_green.max);
  		rangeBullet_green.style.left = (bulletPosition_green * 560 ) + "px";
	}

	function showSliderValue_pink() {
  		rangeBullet_pink.innerHTML = rangeSlider_pink.value;
  		//console.log(rangeSlider.value);
  		var bulletPosition_pink = (rangeSlider_pink.value / rangeSlider_pink.max);
  		rangeBullet_pink.style.left = (bulletPosition_pink * 560 ) + "px";
	}

	function showSliderValue_purple() {
  		rangeBullet_purple.innerHTML = rangeSlider_purple.value;
  		//console.log(rangeSlider.value);
  		var bulletPosition_purple = (rangeSlider_purple.value / rangeSlider_purple.max);
  		rangeBullet_purple.style.left = (bulletPosition_purple * 560 ) + "px";
	}

	//シミュレーションの表を作成する関数
	function makeTable(tableId){
        var rows = [];			   //行の配列生成
		var table = document.createElement('table');	//tableの生成
		var cell;	//要素のセル

		//表の要素生成
		for(i = 0; i < 5; i++){
			rows.push(table.insertRow(-1));
			for(j = 0; j < 5; j++){
				cell = rows[i].insertCell(-1); 
				var s = document.createTextNode(5 * i + j + 1);
				cell.appendChild(s);
				cell.style.fontSize = 40 + "px";
				cell.style.textAlign = "center";
				//各セルの大きさは60px*60px
				cell.style.width = 120 + "px";
				cell.style.height = 120 + "px"
				cell.style.backgroundColor = "#ffffff";	//背景色白
				cell.style.border = "solid 1px black";
			}
		}

		//reset()する際に，表を量産しないように今ある表を先に削除する
		//idの名前を変更する理由は最初読み込むときに表の情報を削除させないため
		var elm = document.getElementById("mytable");
		if (elm) {
			elm.parentNode.removeChild(elm);
		}
		table.id = "mytable";
		//指定したIDに表を加える
		document.getElementById(tableId).appendChild(table);
	}
	

	//色反転の関数
	function reverse(row, column){
		var ini_clr_frag = Array(25);
		ini_clr_frag = clr_frag;

		for(var cnt = 0; cnt < 8; cnt++){
			var px = row;
			var py = column;
			var bx = -1;
			var by = -1;
			if(cnt == 0){
				var dx = 1;
				var dy = 0;			
			}
			else if(cnt == 1){
				var dx = -1;
				var dy = 0;			
			}
			else if(cnt == 2){
				var dx = 0;
				var dy = 1;			
			}	
			else if(cnt == 3){
				var dx = 0;
				var dy = -1;			
			}
			else if(cnt == 4){
				var dx = 1;
				var dy = 1;			
			}
			else if(cnt == 5){
				var dx = 1;
				var dy = -1;			
			}
			else if(cnt == 6){
				var dx = -1;
				var dy = 1;			
			}
			else{
				var dx = -1;
				var dy = -1;			
			}
			var x = px + dx;
			var y = py + dy;
			var f = false;

			var clr_info = ini_clr_frag[row*5+column];

			var while_cnt = 0;

			while(0 <= x && x < 5 && 0 <= y && y < 5){
				//console.log(while_cnt);
				if(cb_frag[x*5+y] == 0){
					//console.log("hoge1");
					break;
				}
				else if(clr_info == ini_clr_frag[x*5+y]){
					//console.log("hoge2");
					if(while_cnt != 0){
						f = true;
					}
					break;
				}
				else{
					//console.log("hoge3");
					bx = x;
					by = y;
					x = x + dx;
					y = y + dy;
				}

				while_cnt++;
			}
			
			if(f){
				console.log("px:" + px + " dx:" + dx + " bx:" + bx + " py:" + py + " dy:" + dy + " by:" + by);
				//console.log("hogef");
				if(cnt == 0 || cnt == 2){
					for(var i = px+dx; i <= bx; i++){
						for(var j = py+dy; j <= by; j++){
							if(clr_info == 0){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#000000";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#ffffff";
							}
							else if(clr_info == 1){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#ff0000";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else if(clr_info == 2){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#0000ff";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else if(clr_info == 3){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#008000";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else if(clr_info == 4){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#ff99cc";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else{
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#800080";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}

							clr_frag[i*5+j] = clr_info;
						}
					}
				}
				else if(cnt == 1 || cnt == 3){
					for(var i = bx; i <= px+dx; i++){
						for(var j = by; j <= py+dy; j++){
							if(clr_info == 0){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#000000";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#ffffff";
							}
							else if(clr_info == 1){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#ff0000";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else if(clr_info == 2){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#0000ff";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else if(clr_info == 3){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#008000";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else if(clr_info == 4){
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#ff99cc";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}
							else{
								document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#800080";
								document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
							}

							clr_frag[i*5+j] = clr_info;
						}
					}
				}
				else{
					var ind = Math.abs((px + dx) - bx);
					var i = px + dx;
					var j = py + dy;
					for(var num = 0; num <= ind; num++){
						if(clr_info == 0){
							document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#000000";
							document.getElementById("mytable").rows[i].cells[j].style.color = "#ffffff";
						}
						else if(clr_info == 1){
							document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#ff0000";
							document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
						}
						else if(clr_info == 2){
							document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#0000ff";
							document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
						}
						else if(clr_info == 3){
							document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#008000";
							document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
						}
						else if(clr_info == 4){
							document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#ff99cc";
							document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
						}
						else{
							document.getElementById("mytable").rows[i].cells[j].style.backgroundColor = "#800080";
							document.getElementById("mytable").rows[i].cells[j].style.color = "#000000";
						}

						clr_frag[i*5+j] = clr_info;
						i += dx;
						j += dy;
					}
				}
			}

		}
	}


	//チェックボックスが押されたら背景色の色を変更
	function cb_change(row, column){
		//console.log(cb_frag[row*5+column])-;
		var ena = document.getElementById("ini_cb");
		if(!at_frag){
			ena[row*5 + column].disabled = true;
		}
		if(cb_frag[row*5+column] == 0){
			if(color == 0){
				document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#000000";
				document.getElementById("mytable").rows[row].cells[column].style.color = "#ffffff";
			}
			else if(color == 1){
				document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#ff0000";
				document.getElementById("mytable").rows[row].cells[column].style.color = "#000000";
			}
			else if(color == 2){
				document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#0000ff";
				document.getElementById("mytable").rows[row].cells[column].style.color = "#000000";
			}
			else if(color == 3){
				document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#008000";
				document.getElementById("mytable").rows[row].cells[column].style.color = "#000000";
			}
			else if(color == 4){
				document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#ff99cc";
				document.getElementById("mytable").rows[row].cells[column].style.color = "#000000";
			}
			else{
				document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#800080";
				document.getElementById("mytable").rows[row].cells[column].style.color = "#000000";
			}

			cb_frag[row*5+column] = 1;
			clr_frag[row*5+column] = color;

		}
		else{
			document.getElementById("mytable").rows[row].cells[column].style.backgroundColor = "#ffffff";
			document.getElementById("mytable").rows[row].cells[column].style.color = "#000000";
			cb_frag[row*5+column] = 0;
			clr_frag[row*5+column] = -1;
		}

		if(at_frag == 0){
			reverse(row, column);
		}

		//カラーの数計算＆更新
		var blackNum = 0;
		var redNum = 0;
		var blueNum = 0;
		var greenNum = 0;
		var pinkNum = 0;
		var purpleNum = 0;
		for(i = 0; i < 25; i++){
			if(clr_frag[i] == 0){
				blackNum++;
			}
			else if(clr_frag[i] == 1){
				redNum++;
			}
			else if(clr_frag[i] == 2){
				blueNum++;
			}
			else if(clr_frag[i] == 3){
				greenNum++;
			}
			else if(clr_frag[i] == 4){
				pinkNum++;
			}
			else if(clr_frag[i] == 5){
				purpleNum++;
			}
			else{}
		}

		rangeSlider_black.value = blackNum;
		showSliderValue_black();
		rangeSlider_red.value = redNum;
		showSliderValue_red();
		rangeSlider_blue.value = blueNum;
		showSliderValue_blue();
		rangeSlider_green.value = greenNum;
		showSliderValue_green();
		rangeSlider_pink.value = pinkNum;
		showSliderValue_pink();
		rangeSlider_purple.value = purpleNum;
		showSliderValue_purple();


	}

	function reset(){
		//tableを生成
		makeTable("table");

		cb_frag.fill(0);
		clr_frag.fill(-1);

		color = 0;
		at_frag = 0;
		document.getElementById("at").checked = false;

		//各ラジオボタンを押せるようにしてチェックはすべて外す
		for(i = 0; i < ini_cb.length; i++){
			document.ini_cb.elements[i].checked = false;
			document.ini_cb.elements[i].disabled = false;
		}
		document.rdobox.elements[0].checked = true;

		rangeSlider_black.value = 0;
		showSliderValue_black();
		rangeSlider_red.value = 0;
		showSliderValue_red();
		rangeSlider_blue.value = 0;
		showSliderValue_blue();
		rangeSlider_green.value = 0;
		showSliderValue_green();
		rangeSlider_pink.value = 0;
		showSliderValue_pink();
		rangeSlider_purple.value = 0;
		showSliderValue_purple();
	}

	function check_reset(){
		var result1 = window.confirm('May I reset that?');
		var result2 = window.confirm('Really?');
		if(result1){
			if(result2){
				reset();
			}
		}
	}

	function attackchance(){
		if(document.getElementById("at").checked){
			at_frag = 1;
			for(i = 0; i < 25; i++){
				document.ini_cb.elements[i].disabled = false;
			}
		}
		else{
			at_frag = 0;
			for(i = 0; i < 25; i++){
				if(document.ini_cb.elements[i].checked){
					document.ini_cb.elements[i].disabled = true;
				}
			}
		}
	}

	function funcBlack(){
		color = 0;
	}

	function funcRed(){
		color = 1;
	}

	function funcBlue(){
		color = 2;
	}

	function funcGreen(){
		color = 3;
	}

	function funcPink(){
		color = 4;
	}

	function funcPurple(){
		color = 5;
	}

	//読み込んだときに場面を初期化する関数reset()を呼び出す
	window.onload = function(){
		reset();
	}
</script>

</body>

</html>
